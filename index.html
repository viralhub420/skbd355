<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SKBD Reward App</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  background:#121212;
  color:white;
  text-align:center;
  font-family: Arial, sans-serif;
  padding:30px;
}
.buttons {
  margin-top:20px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
button {
  padding:14px;
  background:#0088cc;
  color:white;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor: pointer;
  transition: 0.3s;
}
button:active {
  transform: scale(0.98);
}
button:disabled {
  opacity:0.5;
  background: #555;
  cursor: not-allowed;
}
#info {
  background: #1e1e1e;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 20px;
  font-weight: bold;
}
</style>
</head>

<body>
<h2>ğŸš€ SKBD Reward App</h2>
<div id="info">Loading Account...</div>

<div class="buttons">
  <button id="bonusBtn" onclick="claimDailyBonus()">ğŸ Daily Bonus</button>
  <button id="gameBtn" onclick="playGame()">ğŸ® Play Game</button>
  <button id="adBtn" onclick="watchAd()">ğŸ“º Watch Ad (+15 Coins)</button>
  <button id="linkBtn" onclick="clickLink()">ğŸ”— Click Link (+25 Coins)</button>
  <button style="background:#e74c3c;" onclick="tg.close()">âŒ Close App</button>
</div>

<script>
/* ---------------- FIREBASE CONFIG ---------------- */
firebase.initializeApp({
  apiKey: "AIzaSyD8ZSiPZ9HDJV1qGznPOBAu2qYN9lmSqWU",
  authDomain: "skbd355-reward-app.firebaseapp.com",
  projectId: "skbd355-reward-app"
});
const db = firebase.firestore();

/* ---------------- TELEGRAM INIT ---------------- */
const tg = window.Telegram.WebApp;
tg.expand();
const user = tg.initDataUnsafe?.user;
let userRef;
/* ---------------- TELEGRAM MAIN BUTTON (WITHDRAW) ---------------- */
tg.MainButton.text = "ğŸ’° à¦Ÿà¦¾à¦•à¦¾ à¦‰à¦¤à§à¦¤à§‹à¦²à¦¨ (Withdraw)";
tg.MainButton.textColor = "#FFFFFF";
tg.MainButton.color = "#2ecc71"; // à¦¸à¦¬à§à¦œ à¦°à¦™
tg.MainButton.show();

// à¦®à§‡à¦‡à¦¨ à¦¬à¦¾à¦Ÿà¦¨à§‡ à¦•à§à¦²à¦¿à¦• à¦•à¦°à¦²à§‡ à¦•à¦¿ à¦¹à¦¬à§‡
tg.MainButton.onClick(() => {
    userRef.get().then(doc => {
        const balance = doc.data().balance || 0;
        if (balance < 1000) {
            tg.showAlert("âš ï¸ à¦†à¦ªà¦¨à¦¾à¦° à¦¬à§à¦¯à¦¾à¦²à§‡à¦¨à§à¦¸ à§§à§¦à§¦à§¦ à¦•à§Ÿà§‡à¦¨à§‡à¦° à¦•à¦®! à¦†à¦°à¦“ à¦•à¦¾à¦œ à¦•à¦°à§à¦¨à¥¤");
        } else {
            // à¦à¦–à¦¾à¦¨à§‡ à¦‰à¦‡à¦¥à¦¡à§à¦° à¦«à¦°à§à¦® à¦¬à¦¾ à¦®à§‡à¦¸à§‡à¦œ à¦¦à§‡à¦–à¦¾à¦¬à§‡
            tg.showConfirm("à¦†à¦ªà¦¨à¦¿ à¦•à¦¿ à§§à§¦à§¦à§¦ à¦•à§Ÿà§‡à¦¨ à¦‰à¦‡à¦¥à¦¡à§à¦° à¦•à¦°à¦¤à§‡ à¦šà¦¾à¦¨?", (ok) => {
                if (ok) {
                    alert("à¦†à¦ªà¦¨à¦¾à¦° à¦°à¦¿à¦•à§‹à§Ÿà§‡à¦¸à§à¦Ÿ à¦ªà¦¾à¦ à¦¾à¦¨à§‹ à¦¹à§Ÿà§‡à¦›à§‡ (à¦‰à¦‡à¦¥à¦¡à§à¦° à¦ªà§‡à¦œ à§ª-à¦ à¦†à¦¸à¦¬à§‡)");
                }
            });
        }
    });
});

/* ---------------- MONETAG LINK SETUP ---------------- */
const AD_LINK = "https://otieu.com/4/10540712"; // à¦†à¦ªà¦¨à¦¾à¦° à¦¡à¦¾à¦‡à¦°à§‡à¦•à§à¦Ÿ à¦²à¦¿à¦™à§à¦•

/* ---------------- USER DATA SYNC ---------------- */
if (user) {
  userRef = db.collection("users").doc(String(user.id));
  
  // Real-time Update (à¦‡à¦‰à¦œà¦¾à¦°à§‡à¦° à¦¬à§à¦¯à¦¾à¦²à§‡à¦¨à§à¦¸ à¦…à¦Ÿà§‹ à¦†à¦ªà¦¡à§‡à¦Ÿ à¦¹à¦¬à§‡)
  userRef.onSnapshot(doc => {
    if (doc.exists) {
      const u = doc.data();
      document.getElementById("info").innerText = 
        `ğŸ‘¤ ID: ${u.telegram_id} | ğŸ’° Coins: ${u.balance}`;
    } else {
      userRef.set({
        telegram_id: user.id,
        name: user.first_name || "Unknown",
        balance: 0,
        total_earned: 0,
        last_bonus: null,
        last_ad: null,
        last_link: null
      });
    }
  });
} else {
  document.getElementById("info").innerText = "âš ï¸ Please open from Telegram";
}

/* ---------------- DAILY BONUS ---------------- */
function claimDailyBonus() {
  if (!userRef) return;
  userRef.get().then(doc => {
    const d = doc.data();
    const now = Date.now();
    const last = d.last_bonus ? d.last_bonus.toMillis() : 0;
    
    if (now - last < 86400000) {
      alert("â³ à§¨à§ª à¦˜à¦£à§à¦Ÿà¦¾ à¦ªà¦° à¦†à¦¬à¦¾à¦° à¦Ÿà§à¦°à¦¾à¦‡ à¦•à¦°à§à¦¨!");
      return;
    }
    
    userRef.update({
      balance: firebase.firestore.FieldValue.increment(10),
      total_earned: firebase.firestore.FieldValue.increment(10),
      last_bonus: firebase.firestore.Timestamp.now()
    }).then(() => alert("ğŸ‰ +10 Coins Added!"));
  });
}

/* ---------------- WATCH AD (MONETAG DIRECT LINK) ---------------- */
function watchAd() {
  if (!userRef) return;
  const btn = document.getElementById("adBtn");
  

  userRef.get().then(doc => {
    const last = doc.data().last_ad?.toMillis() || 0;
    if (Date.now() - last < 600000) { // à§§à§¦ à¦®à¦¿à¦¨à¦¿à¦Ÿ à¦²à¦•
      alert("â³ à§§à§¦ à¦®à¦¿à¦¨à¦¿à¦Ÿ à¦ªà¦°à§‡ à¦†à¦¬à¦¾à¦° à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à§‹");
      return;
    }

    btn.disabled = true;
    btn.innerText = "Ad Loading...";

    // Monetag à¦…à§à¦¯à¦¾à¦¡ à¦“à¦ªà§‡à¦¨ à¦•à¦°à¦¾
    tg.openLink(AD_LINK);

    // à§§à§¦ à¦¸à§‡à¦•à§‡à¦¨à§à¦¡ à¦ªà¦° à¦°à¦¿à¦“à§Ÿà¦¾à¦°à§à¦¡ à¦•à§à¦°à§‡à¦¡à¦¿à¦Ÿ
    setTimeout(() => {
      userRef.update({
        balance: firebase.firestore.FieldValue.increment(15),
        total_earned: firebase.firestore.FieldValue.increment(15),
        last_ad: firebase.firestore.Timestamp.now()
      }).then(() => {
        alert("âœ… Ad Complete! +15 Coins");
        btn.disabled = false;
        btn.innerText = "ğŸ“º Watch Ad (+15 Coins)";
      });
    }, 10000);
  });
}

/* ---------------- CLICK LINK (REWARD) ---------------- */
function clickLink() {
  if (!userRef) return;
  const btn = document.getElementById("linkBtn");
  const directLink = "https://otieu.com/4/10540712";

  userRef.get().then(doc => {
    const last = doc.data().last_link?.toMillis() || 0;
    if (Date.now() - last < 3600000) { // à§§ à¦˜à¦£à§à¦Ÿà¦¾ à¦²à¦•
      alert("â³ à§§ à¦˜à¦£à§à¦Ÿà¦¾ à¦ªà¦° à¦†à¦¬à¦¾à¦° à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à§‹");
      return;
    }

    btn.disabled = true;
    tg.openLink(directLink);

    setTimeout(() => {
      userRef.update({
        balance: firebase.firestore.FieldValue.increment(25),
        total_earned: firebase.firestore.FieldValue.increment(25),
        last_link: firebase.firestore.Timestamp.now()
      }).then(() => {
        alert("ğŸ”— Link Visit Success! +25 Coins");
        btn.disabled = false;
      });
    }, 8000);
  });
}

/* ---------------- GAME (DEMO) ---------------- */
function playGame() {
  alert("ğŸ® à¦—à§‡à¦® à¦«à¦¿à¦šà¦¾à¦°à¦Ÿà¦¿ à¦¶à§€à¦˜à§à¦°à¦‡ à¦¯à§à¦•à§à¦¤ à¦•à¦°à¦¾ à¦¹à¦¬à§‡!");
}
</script>
</body>
</html>
