<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SKBD Reward App</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  background:#121212;
  color:white;
  text-align:center;
  font-family: Arial, sans-serif;
  padding:30px;
}
.buttons {
  margin-top:20px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
button {
  padding:14px;
  background:#0088cc;
  color:white;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor: pointer;
  transition: 0.3s;
}
button:active {
  transform: scale(0.98);
}
button:disabled {
  opacity:0.5;
  background: #555;
  cursor: not-allowed;
}
#info {
  background: #1e1e1e;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 20px;
  font-weight: bold;
}
</style>
</head>

<body>
<h2>ЁЯЪА SKBD Reward App</h2>
<div id="info">Loading Account...</div>

<div class="buttons">
  <button id="bonusBtn" onclick="claimDailyBonus()">ЁЯОБ Daily Bonus</button>
  <button id="gameBtn" onclick="playGame()">ЁЯОо Play Game</button>
  <button id="adBtn" onclick="watchAd()">ЁЯУ║ Watch Ad (+15 Coins)</button>
  <button id="linkBtn" onclick="clickLink()">ЁЯФЧ Click Link (+25 Coins)</button>
  <button style="background:#e74c3c;" onclick="tg.close()">тЭМ Close App</button>
</div>

<script>
/* ---------------- FIREBASE CONFIG ---------------- */
firebase.initializeApp({
  apiKey: "AIzaSyD8ZSiPZ9HDJV1qGznPOBAu2qYN9lmSqWU",
  authDomain: "skbd355-reward-app.firebaseapp.com",
  projectId: "skbd355-reward-app"
});
const db = firebase.firestore();

/* ---------------- TELEGRAM INIT ---------------- */
const tg = window.Telegram.WebApp;
tg.expand();
const user = tg.initDataUnsafe?.user;
let userRef;

/* ---------------- MONETAG LINK SETUP ---------------- */
const AD_LINK = "https://otieu.com/4/10540712"; 

/* ---------------- WITHDRAW SYSTEM (FINAL STEP 4) ---------------- */
tg.MainButton.text = "ЁЯТ░ ржЯрж╛ржХрж╛ ржЙрждрзНрждрзЛрж▓ржи (Withdraw)";
tg.MainButton.textColor = "#FFFFFF";
tg.MainButton.color = "#2ecc71";
tg.MainButton.show();

tg.MainButton.onClick(() => {
    if (!userRef) return;
    
    userRef.get().then(doc => {
        const balance = doc.data().balance || 0;
        
        // рззрзжрзжрзж ржХрзЯрзЗржи ржЖржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рж╛
        if (balance < 1000) {
            tg.showAlert("тЪая╕П ржЖржкржирж╛рж░ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ рззрзжрзжрзж ржХрзЯрзЗржирзЗрж░ ржХржо! ржХрж╛ржЬ ржХрж░рзЗ ржХрзЯрзЗржи ржЬржорж╛ржиред");
        } else {
            // ржЗржЙржЬрж╛рж░рзЗрж░ ржХрж╛ржЫ ржерзЗржХрзЗ ржкрзЗржорзЗржирзНржЯ ржиржорзНржмрж░ ржирзЗржУрзЯрж╛
            const phoneNumber = prompt("ржЖржкржирж╛рж░ ржмрж┐ржХрж╛рж╢ ржмрж╛ ржиржЧржж ржиржорзНржмрж░ржЯрж┐ рж▓рж┐ржЦрзБржи:");
            
            if (phoneNumber && phoneNumber.length >= 11) {
                tg.showConfirm(`ржЖржкржирж┐ ржХрж┐ ${phoneNumber} ржиржорзНржмрж░рзЗ рззрзжрзжрзж ржХрзЯрзЗржи ржЙржЗржержбрзНрж░ ржХрж░рждрзЗ ржЪрж╛ржи?`, (ok) => {
                    if (ok) {
                        // рзз. ржлрж╛рзЯрж╛рж░ржмрзЗржЬрзЗ 'withdraws' ржирж╛ржорзЗ ржирждрзБржи ржХрж╛рж▓рзЗржХрж╢ржирзЗ ржбрж╛ржЯрж╛ рж╕рзЗржн ржХрж░рж╛
                        db.collection("withdraws").add({
                            user_id: user.id,
                            name: user.first_name || "Unknown",
                            payment_number: phoneNumber,
                            amount: 1000,
                            status: "pending",
                            date: firebase.firestore.Timestamp.now()
                        }).then(() => {
                            // рзи. ржЗржЙржЬрж╛рж░рзЗрж░ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ржерзЗржХрзЗ рззрзжрзжрзж ржХрзЯрзЗржи ржХрзЗржЯрзЗ ржирзЗржУрзЯрж╛
                            userRef.update({
                                balance: firebase.firestore.FieldValue.increment(-1000)
                            });
                            tg.showAlert("тЬЕ рж╕ржлрж▓! ржЖржкржирж╛рж░ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржПржмржВ ржиржорзНржмрж░ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ рж╕рзЗржн ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗред");
                        }).catch((error) => {
                            tg.showAlert("тЭМ ржбрж╛ржЯрж╛ рж╕рзЗржн рж╣рзЯржирж┐! ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред");
                        });
                    }
                });
            } else if (phoneNumber !== null) {
                tg.showAlert("тЭМ рж╕ржарж┐ржХ ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░ ржжрж┐ржи!");
            }
        }
    });
});

/* ---------------- USER DATA SYNC ---------------- */
if (user) {
  userRef = db.collection("users").doc(String(user.id));
  userRef.onSnapshot(doc => {
    if (doc.exists) {
      const u = doc.data();
      document.getElementById("info").innerText = 
        `ЁЯСд ID: ${u.telegram_id} | ЁЯТ░ Coins: ${u.balance}`;
    } else {
      userRef.set({
        telegram_id: user.id,
        name: user.first_name || "Unknown",
        balance: 0,
        total_earned: 0,
        last_bonus: null,
        last_ad: null,
        last_link: null
      });
    }
  });
} else {
  document.getElementById("info").innerText = "тЪая╕П Please open from Telegram";
}

/* ---------------- DAILY BONUS ---------------- */
function claimDailyBonus() {
  if (!userRef) return;
  userRef.get().then(doc => {
    const d = doc.data();
    const now = Date.now();
    const last = d.last_bonus ? d.last_bonus.toMillis() : 0;
    
    if (now - last < 86400000) {
      alert("тП│ рзирзк ржШржгрзНржЯрж╛ ржкрж░ ржЖржмрж╛рж░ ржЯрзНрж░рж╛ржЗ ржХрж░рзБржи!");
      return;
    }
    
    userRef.update({
      balance: firebase.firestore.FieldValue.increment(10),
      total_earned: firebase.firestore.FieldValue.increment(10),
      last_bonus: firebase.firestore.Timestamp.now()
    }).then(() => alert("ЁЯОЙ +10 Coins Added!"));
  });
}

/* ---------------- WATCH AD (MONETAG) ---------------- */
function watchAd() {
  if (!userRef) return;
  const btn = document.getElementById("adBtn");

  userRef.get().then(doc => {
    const last = doc.data().last_ad?.toMillis() || 0;
    if (Date.now() - last < 600000) { 
      alert("тП│ рззрзж ржорж┐ржирж┐ржЯ ржкрж░рзЗ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзЛ");
      return;
    }

    btn.disabled = true;
    btn.innerText = "Ad Loading...";
    tg.openLink(AD_LINK);

    setTimeout(() => {
      userRef.update({
        balance: firebase.firestore.FieldValue.increment(15),
        total_earned: firebase.firestore.FieldValue.increment(15),
        last_ad: firebase.firestore.Timestamp.now()
      }).then(() => {
        alert("тЬЕ Ad Complete! +15 Coins");
        btn.disabled = false;
        btn.innerText = "ЁЯУ║ Watch Ad (+15 Coins)";
      });
    }, 10000);
  });
}

/* ---------------- CLICK LINK (REWARD) ---------------- */
function clickLink() {
  if (!userRef) return;
  const btn = document.getElementById("linkBtn");

  userRef.get().then(doc => {
    const last = doc.data().last_link?.toMillis() || 0;
    if (Date.now() - last < 3600000) { 
      alert("тП│ рзз ржШржгрзНржЯрж╛ ржкрж░ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзЛ");
      return;
    }

    btn.disabled = true;
    tg.openLink(AD_LINK);

    setTimeout(() => {
      userRef.update({
        balance: firebase.firestore.FieldValue.increment(25),
        total_earned: firebase.firestore.FieldValue.increment(25),
        last_link: firebase.firestore.Timestamp.now()
      }).then(() => {
        alert("ЁЯФЧ Link Visit Success! +25 Coins");
        btn.disabled = false;
      });
    }, 8000);
  });
}

function playGame() {
  alert("ЁЯОо ржЧрзЗржо ржлрж┐ржЪрж╛рж░ржЯрж┐ рж╢рзАржШрзНрж░ржЗ ржпрзБржХрзНржд ржХрж░рж╛ рж╣ржмрзЗ!");
}
</script>
</body>
  </html>
  
